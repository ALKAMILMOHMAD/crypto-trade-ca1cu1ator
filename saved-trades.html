
<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>الصفقات المحفوظة</title>
<style>
  body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; background: #f9f9f9; }
  .trade { background: white; border: 1px solid #ccc; margin-bottom: 20px; padding: 15px; border-radius: 8px; }
  img { max-width: 100%; height: auto; margin-top: 10px; }
  .btn { padding: 8px 12px; margin: 5px; cursor: pointer; }
  .profit { background: #d4edda; }
  .loss { background: #f8d7da; }
</style>
</head>
<body>
<h2>الصفقات المحفوظة</h2>
<div id="tradesContainer"></div>

<script>
function loadTrades() {
  const container = document.getElementById('tradesContainer');
  const trades = JSON.parse(localStorage.getItem('savedTrades') || '[]');
  container.innerHTML = '';

  if (trades.length === 0) {
    container.innerHTML = '<p>لا توجد صفقات محفوظة حالياً.</p>';
    return;
  }

  trades.forEach((trade, index) => {
    const tradeDiv = document.createElement('div');
    tradeDiv.className = 'trade';
    tradeDiv.innerHTML = `
      <h3>${trade.coinName} (${trade.tradeType === 'buy' ? 'شراء' : 'بيع'})</h3>
      <p>رأس المال: ${trade.capital}$ - المخاطرة: ${trade.riskPercent}%</p>
      <p>سعر الدخول: ${trade.entryPrice} - الاستوب: ${trade.stopLossPrice}</p>
      <p>تاريخ الحفظ: ${trade.date}</p>
      <button class="btn" onclick="deleteTrade(${index})">حذف الصفقة</button>
      <img src="${trade.chartImage}" alt="صورة الشارت" />
      ${trade.status === 'open' ? `
        <button class="btn profit" onclick="closeTrade(${index}, 'profit')">تم الإغلاق بربح</button>
        <button class="btn loss" onclick="closeTrade(${index}, 'loss')">تم الإغلاق بخسارة</button>
      ` : `<p><strong>الحالة:</strong> ${trade.status === 'profit' ? 'ربح' : 'خسارة'} ${trade.closedAt ? '- تم عند الهدف ' + trade.closedAt : ''}</p>`}
    `;
    if (trade.status === 'profit') {
      for (let i = 1; i <= 5; i++) {
        const btn = document.createElement('button');
        btn.textContent = 'تم الإغلاق عند الهدف ' + i;
        btn.className = 'btn';
        btn.onclick = () => setGoal(index, i);
        tradeDiv.appendChild(btn);
      }
    }
    container.appendChild(tradeDiv);
  });
}

function closeTrade(index, status) {
  const trades = JSON.parse(localStorage.getItem('savedTrades'));
  trades[index].status = status;
  localStorage.setItem('savedTrades', JSON.stringify(trades));
  loadTrades();
}

function setGoal(index, goalNumber) {
  const trades = JSON.parse(localStorage.getItem('savedTrades'));
  trades[index].closedAt = goalNumber;
  localStorage.setItem('savedTrades', JSON.stringify(trades));
  loadTrades();
}

function deleteTrade(index) {
  if (confirm('هل أنت متأكد من حذف هذه الصفقة؟')) {
    const trades = JSON.parse(localStorage.getItem('savedTrades'));
    trades.splice(index, 1);
    localStorage.setItem('savedTrades', JSON.stringify(trades));
    loadTrades();
  }
}

window.onload = loadTrades;
</script>
</body>
</html>
