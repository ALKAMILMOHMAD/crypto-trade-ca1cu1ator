
<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>حاسبة تداول العملات الرقمية</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; direction: rtl; background: #f0f0f0; }
    nav { background: #222; color: white; padding: 10px; text-align: center; margin-bottom: 20px; }
    nav a { color: white; margin: 0 15px; text-decoration: none; }
    label, input, select { display: block; margin: 10px 0; width: 100%; }
    .result { background: white; padding: 15px; margin-top: 20px; border-radius: 8px; }
    .goal { margin-top: 10px; padding: 10px; background: #e6f7ff; border-radius: 6px; }
    button.copy-btn { margin-right: 10px; }
  </style>
</head>
<body>
<nav>
  <a href="index.html">الحاسبة</a>
  <a href="saved-trades.html">الصفقات المحفوظة</a>
  <a href="evaluation.html">التقييم</a>
</nav>

<h2>حاسبة تداول العملات الرقمية</h2>
<label>نوع الصفقة:
  <select id="tradeType">
    <option value="buy">شراء (صعود)</option>
    <option value="sell">بيع (هبوط)</option>
  </select>
</label>
<label>رأس المال (USD):
  <input type="number" id="capital" />
</label>
<label>نسبة المخاطرة (%):
  <input type="number" id="riskPercent" />
</label>
<label>سعر الدخول:
  <input type="number" id="entryPrice" />
</label>
<label>سعر الاستوب لوز:
  <input type="number" id="stopLossPrice" />
</label>

<div class="result" id="results"></div>
<button onclick="showSaveModal()">حفظ الصفقة</button>

<div id="saveModal" style="display:none; background:white; padding:15px; border-radius:8px; margin-top:20px;">
  <h3>حفظ الصفقة</h3>
  <label>اسم العملة: <input type="text" id="coinName" /></label>
  <label>صورة الشارت: <input type="file" id="chartImage" accept="image/*" /></label>
  <button onclick="saveTrade()">تأكيد الحفظ</button>
  <button onclick="document.getElementById('saveModal').style.display='none'">إلغاء</button>
</div>

<script>
function copyToClipboard(text) {
  navigator.clipboard.writeText(text);
  alert('تم النسخ: ' + text);
}

function calculate() {
  const tradeType = document.getElementById('tradeType').value;
  const capital = parseFloat(document.getElementById('capital').value);
  const riskPercent = parseFloat(document.getElementById('riskPercent').value);
  const entryPrice = parseFloat(document.getElementById('entryPrice').value);
  const stopLossPrice = parseFloat(document.getElementById('stopLossPrice').value);

  const resultDiv = document.getElementById('results');
  if ([capital, riskPercent, entryPrice, stopLossPrice].some(isNaN)) {
    resultDiv.innerHTML = 'يرجى إدخال جميع القيم.';
    return;
  }

  if ((tradeType === 'buy' && stopLossPrice >= entryPrice) ||
      (tradeType === 'sell' && stopLossPrice <= entryPrice)) {
    resultDiv.innerHTML = 'تأكد من أن الاستوب لوز صحيح حسب نوع الصفقة.';
    return;
  }

  const lossPerUnit = Math.abs(entryPrice - stopLossPrice);
  const riskAmount = capital * (riskPercent / 100);
  const amountUnits = riskAmount / lossPerUnit;
  const totalTradeValue = amountUnits * entryPrice;

  const goalPercents = [riskPercent, riskPercent * 2, 4, 6, 8];
  const goals = goalPercents.map((percent, index) => {
    const profitAmount = capital * (percent / 100);
    const priceDiff = profitAmount / amountUnits;
    let goalPrice;
    if (tradeType === 'buy') {
      goalPrice = entryPrice + priceDiff;
    } else {
      goalPrice = entryPrice - priceDiff;
    }
    return {
      level: index + 1,
      price: goalPrice.toFixed(6),
      profitAmount: profitAmount.toFixed(2),
      profitPercent: percent.toFixed(2)
    };
  });

  let html = `<p>عدد العملات: <strong>${amountUnits.toFixed(6)}</strong>
    <button class="copy-btn" onclick="copyToClipboard('${amountUnits.toFixed(6)}')">نسخ</button></p>`;
  html += `<p>قيمة الصفقة: <strong>${totalTradeValue.toFixed(2)}$</strong></p>`;
  html += `<p>الخسارة المحتملة عند الاستوب لوز: <strong>${riskAmount.toFixed(2)}$</strong></p>`;
  html += '<h3>الأهداف:</h3>';
  goals.forEach(goal => {
    html += `<div class="goal">الهدف ${goal.level}: السعر = <strong>${goal.price}</strong> | الربح = ${goal.profitAmount}$ (${goal.profitPercent}%)</div>`;
  });

  resultDiv.innerHTML = html;
}

function showSaveModal() {
  document.getElementById('saveModal').style.display = 'block';
}

function saveTrade() {
  const trade = {
    id: Date.now(),
    tradeType: document.getElementById('tradeType').value,
    capital: document.getElementById('capital').value,
    riskPercent: document.getElementById('riskPercent').value,
    entryPrice: document.getElementById('entryPrice').value,
    stopLossPrice: document.getElementById('stopLossPrice').value,
    coinName: document.getElementById('coinName').value,
    date: new Date().toLocaleString()
  };
  const file = document.getElementById('chartImage').files[0];
  if (!file) return alert("يرجى رفع صورة.");
  const reader = new FileReader();
  reader.onload = function(e) {
    trade.chartImage = e.target.result;
    const trades = JSON.parse(localStorage.getItem('savedTrades') || '[]');
    trades.push(trade);
    localStorage.setItem('savedTrades', JSON.stringify(trades));
    alert("تم حفظ الصفقة.");
    document.getElementById('saveModal').style.display = 'none';
  };
  reader.readAsDataURL(file);
}

document.querySelectorAll("input, select").forEach(e => e.addEventListener("input", calculate));
</script>
</body>
</html>
